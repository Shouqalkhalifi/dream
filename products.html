<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src 'self'; base-uri 'self'; form-action 'self'">
  <title>dream â€” Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</title>
  <meta name="description" content="Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§Øª dream: Ø±Ù‚Ù…ÙŠØ© Ù„Ù„ØªÙ†Ø²ÙŠÙ„ ÙˆÙ…Ù„Ù…ÙˆØ³Ø© Ù…Ø¹ ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹.">
  <style>
    :root{
      --bg:#0b0d11; --panel:#0f1115; --card:#121722;
      --txt:#eef1f5; --muted:#a6b0c0; --border:rgba(255,255,255,.08);
      --shadow:0 12px 30px rgba(0,0,0,.35);
      --btn:#3ba9ff; --btnTxt:#051018; --chip:#101522; --badge:#1b2230;
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",sans-serif}
    a{color:var(--txt);text-decoration:none}
    .container{max-width:1200px;margin:auto;padding:20px}

    .page-head{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin:8px 0 16px}
    .title{font-size:28px;margin:0}
    .controls{display:flex;gap:10px;align-items:center}
    .filters{display:flex;gap:8px}
    .chip{
      border:1px solid var(--border); background:var(--chip); color:var(--txt); padding:8px 12px;
      border-radius:999px; cursor:pointer; font-weight:700
    }
    .chip.active{background:var(--btn); color:var(--btnTxt); border-color:transparent}
    select{
      border:1px solid var(--border); background:var(--card); color:var(--txt); padding:9px 12px; border-radius:10px; outline:none
    }

    .grid{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;overflow:hidden;display:flex;flex-direction:column;transition:transform .15s, box-shadow .15s}
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow)}
    .thumb{aspect-ratio:16/10;background:#0f141f;display:flex;align-items:center;justify-content:center;font-size:40px}
    .content{padding:14px}
    .name{font-weight:800;margin:0 0 6px}
    .muted{color:var(--muted);font-size:13px}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px}
    .badge{border:1px dashed var(--border);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--muted);background:var(--badge)}
    .actions{margin-top:12px;display:flex;gap:8px}
    .btn{flex:1;border:none;background:var(--btn);color:var(--btnTxt);padding:10px 12px;border-radius:10px;font-weight:800;cursor:pointer;text-align:center}
    .btn.outline{background:transparent;color:var(--txt);border:1px solid var(--border)}

    /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø³Ù„Ø© */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:65}
    .overlay.show{display:flex}
    .cart{width:min(560px,92vw);background:var(--panel);border:1px solid var(--border);border-radius:20px;padding:16px;box-shadow:var(--shadow);color:var(--txt)}
    .cart h3{margin:0 0 10px}
    .cart .r{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:10px 0;border-bottom:1px solid var(--border)}
    .cart .r:last-child{border-bottom:none}
    .qty{display:flex;gap:8px;align-items:center}
    .qty button{border:1px solid var(--border);background:transparent;color:var(--txt);padding:4px 8px;border-radius:8px;cursor:pointer}
    .checkout{margin-top:12px;display:flex;gap:8px;justify-content:flex-end}
    .checkout .btn{min-width:140px}

    /* Toasts */
    .toasts{position:fixed;inset:auto 16px 16px auto;display:flex;flex-direction:column;gap:10px;z-index:80}
    .toast{background:#0f141f;color:var(--txt);border:1px solid var(--border);padding:10px 12px;border-radius:12px;box-shadow:var(--shadow);min-width:240px}

    @media (max-width:1100px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:700px){ .grid{grid-template-columns:repeat(2,1fr)} }
    @media (max-width:480px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <!-- Ù‡ÙŠØ¯Ø± -->
  <div id="app-header" aria-hidden="true"></div>

  <main class="container">
    <header class="page-head">
      <h1 class="title">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h1>
      <div class="controls" role="toolbar" aria-label="ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª">
        <div class="filters" role="tablist" aria-label="ÙÙ„Ø§ØªØ±">
          <button class="chip active" data-filter="all" role="tab">Ø§Ù„ÙƒÙ„</button>
          <button class="chip" data-filter="digital" role="tab">Ø±Ù‚Ù…ÙŠØ©</button>
          <button class="chip" data-filter="physical" role="tab">Ù…Ù„Ù…ÙˆØ³Ø©</button>
        </div>
        <select id="sort" aria-label="ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨">
          <option value="pop">Ø§Ù„Ø£ÙƒØ«Ø± Ø´ÙŠÙˆØ¹Ù‹Ø§</option>
          <option value="name">Ø§Ù„Ø§Ø³Ù… (Ø£-ÙŠ)</option>
          <option value="price">Ø§Ù„Ø³Ø¹Ø± (Ù…Ù† Ø§Ù„Ø£Ù‚Ù„)</option>
        </select>
      </div>
    </header>

    <section>
      <div id="grid" class="grid" aria-live="polite"></div>
    </section>
  </main>

  <!-- ÙÙˆØªØ± -->
  <div id="app-footer" aria-hidden="true"></div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø³Ù„Ø© -->
  <div id="cartOverlay" class="overlay" aria-hidden="true">
    <div class="cart" role="dialog" aria-modal="true" aria-labelledby="cartTitle">
      <h3 id="cartTitle">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h3>
      <div id="cartRows"></div>
      <div class="checkout">
        <button class="btn outline" id="closeCart">Ø¥ØºÙ„Ø§Ù‚</button>
        <button class="btn" id="checkoutBtn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div class="toasts" id="toasts" aria-live="polite" aria-atomic="true"></div>

  <script type="module">
    /* ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù‡ÙŠØ¯Ø± ÙˆØ§Ù„ÙÙˆØªØ± */
    async function include(id, file){
      const el = document.getElementById(id);
      try{
        const res = await fetch(file, {cache:"no-store"}); if(!res.ok) throw 0;
        const html = await res.text();
        el.innerHTML = html;
        el.querySelectorAll('script').forEach(old=>{
          const s=document.createElement('script'); if(old.type) s.type=old.type;
          s.textContent=old.textContent; el.appendChild(s); old.remove();
        });
        el.setAttribute('aria-hidden','false');
      }catch{
        el.innerHTML = '<div class="container" style="color:#f88">ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ '+file+'</div>';
      }
    }
    await include('app-header','header.html');
    await include('app-footer','footer.html');

    /* Ø¨ÙŠØ§Ù†Ø§Øª */
    const products = [
      {id:'d1', type:'digital', title:'Ù‚Ø§Ù„Ø¨ UI Ø£Ø¨ÙŠØ¶/Ø£Ø³ÙˆØ¯', desc:'Figma + SVG', price:69, icon:'â¬›', stock:Infinity, pop:92},
      {id:'d2', type:'digital', title:'Ø¨Ø§ÙŠØ«ÙˆÙ† Ø¨Ø§Ùƒ: Ø£Ø¯ÙˆØ§Øª ØªØ­Ù„ÙŠÙ„', desc:'CLI + Docs', price:119, icon:'â¬œ', stock:Infinity, pop:88},
      {id:'d3', type:'digital', title:'Ù…Ø¤Ø«Ø±Ø§Øª ØµÙˆØªÙŠØ© Minimal', desc:'WAV/MP3', price:39, icon:'â—»ï¸', stock:Infinity, pop:74},
      {id:'d4', type:'digital', title:'Ø®Ø· Ø¹Ø±Ø¨ÙŠ Ø­Ø¯ÙŠØ«', desc:'OTF/TTF', price:49, icon:'â—¼ï¸', stock:Infinity, pop:80},
      {id:'p1', type:'physical', title:'Ø¯ÙØªØ± Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø£Ø³ÙˆØ¯', desc:'ÙˆØ±Ù‚ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø©', price:59, icon:'ğŸ““', stock:20, pop:77},
      {id:'p2', type:'physical', title:'ÙƒÙˆØ¨ Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ Ø£Ø¨ÙŠØ¶', desc:'Ù…Ù‚Ø§ÙˆÙ… Ù„Ù„Ø­Ø±Ø§Ø±Ø©', price:45, icon:'â˜•', stock:35, pop:83},
      {id:'p3', type:'physical', title:'ØªÙŠØ´ÙŠØ±Øª dream', desc:'Ù‚Ø·Ù† 100%', price:99, icon:'ğŸ‘•', stock:18, pop:90},
      {id:'p4', type:'physical', title:'Ù…Ù„ØµÙ‚Ø§Øª Minimal', desc:'Ù…Ø¬Ù…ÙˆØ¹Ø© 10 Ù‚Ø·Ø¹', price:25, icon:'ğŸ·ï¸', stock:50, pop:60},
    ];

    const grid = document.getElementById('grid');
    const chips = document.querySelectorAll('.chip');
    const sortSel = document.getElementById('sort');

    const CART_KEY = 'dream.cart.v1';
    const cart = new Map(JSON.parse(localStorage.getItem(CART_KEY) || '[]'));
    const persistCart = () => { localStorage.setItem(CART_KEY, JSON.stringify([...cart.entries()])); window.dispatchEvent(new Event('dream:cartUpdated')); };
    const money = v => new Intl.NumberFormat('ar-SA',{style:'currency',currency:'SAR'}).format(v);

    /* Ø¥Ø´Ø¹Ø§Ø± */
    const toasts = document.getElementById('toasts');
    function toast(msg){
      const t = document.createElement('div'); t.className='toast'; t.textContent = msg;
      toasts.appendChild(t); setTimeout(()=>{ t.style.opacity='0'; t.style.transform='translateY(8px)'; }, 2200);
      setTimeout(()=> t.remove(), 2800);
    }

    function waLink(title){
      const body = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬: ${title}`;
      return 'https://wa.me/966504317267?text=' + encodeURIComponent(body);
    }
    const norm = s => (s||'').toString().toLowerCase();

    function applySort(list){
      const v = sortSel.value;
      if(v==='price') return list.slice().sort((a,b)=>a.price-b.price);
      if(v==='name')  return list.slice().sort((a,b)=>a.title.localeCompare(b.title,'ar'));
      return list.slice().sort((a,b)=>b.pop-a.pop);
    }

    /* Ø±Ø³Ù… */
    let currentFilter='all', currentSearch='';
    function render(filter='all', search=''){
      const q = norm(search).trim();
      grid.innerHTML='';
      let list = products
        .filter(p => (filter==='all' || p.type===filter))
        .filter(p => !q || norm(p.title).includes(q) || norm(p.desc).includes(q));
      list = applySort(list);

      if(list.length===0){
        const empty = document.createElement('div');
        empty.className='card';
        empty.innerHTML = `<div class="content"><h3 class="name">Ù„Ø§ Ù†ØªØ§Ø¦Ø¬</h3><div class="muted">Ø¬Ø±Ù‘Ø¨ÙŠ ÙƒÙ„Ù…Ø© Ø£Ù‚ØµØ± Ø£Ùˆ Ù…Ø®ØªÙ„ÙØ©.</div></div>`;
        grid.appendChild(empty);
        return;
      }
      for(const p of list){
        const el = document.createElement('article');
        el.className='card';
        el.innerHTML = `
          <div class="thumb" aria-hidden="true">${p.icon}</div>
          <div class="content">
            <h3 class="name">${p.title}</h3>
            <div class="muted">${p.desc}</div>
            <div class="row">
              <span>${money(p.price)}</span>
              <span class="badge">${p.type==='digital'?'Ø±Ù‚Ù…ÙŠ':'Ù…Ù„Ù…ÙˆØ³'}</span>
            </div>
            <div class="actions">
              <button class="btn" data-id="${p.id}" ${p.stock===0?'disabled':''}>${p.stock===0?'ØºÙŠØ± Ù…ØªÙˆÙØ±':'Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©'}</button>
              <a class="btn outline" href="${waLink(p.title)}" target="_blank" rel="noopener">ÙˆØ§ØªØ³Ø§Ø¨</a>
            </div>
          </div>`;
        grid.appendChild(el);
      }
    }
    render();

    /* ÙÙ„Ø§ØªØ± ÙˆØªØ±ØªÙŠØ¨ */
    chips.forEach(ch=> ch.addEventListener('click', ()=>{
      chips.forEach(x=>x.classList.remove('active'));
      ch.classList.add('active'); currentFilter = ch.dataset.filter; render(currentFilter, currentSearch);
    }));
    sortSel.addEventListener('change', ()=> render(currentFilter, currentSearch));

    /* Ø¯Ø¹Ù… #digital / #physical Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· */
    function applyHash(){
      const h = (location.hash||'').replace('#','');
      if(['digital','physical','all'].includes(h)){
        currentFilter = h; chips.forEach(x=>x.classList.toggle('active', x.dataset.filter===h));
        render(currentFilter, currentSearch);
      }
    }
    window.addEventListener('hashchange', applyHash); applyHash();

    /* Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¨Ø­Ø« Ù…Ù† Ø§Ù„Ù‡ÙŠØ¯Ø± */
    window.addEventListener('dream:search', (e)=>{
      currentSearch = (e.detail?.value || '').toString();
      render(currentFilter, currentSearch);
      grid.scrollIntoView({behavior:'smooth', block:'start'});
    });

    /* === Ø§Ù„Ø³Ù„Ø©: ÙˆØ¶Ø¹ Ø³Ø±ÙŠØ¹/ÙƒØ§Ù…Ù„ === */
    const overlay = document.getElementById('cartOverlay');
    const rows = document.getElementById('cartRows');
    const closeCartBtn = document.getElementById('closeCart');
    const checkoutBtn = document.getElementById('checkoutBtn');
    let cartMode = 'full';

    function setCartMode(mode){
      cartMode = (mode==='quick') ? 'quick' : 'full';
      if(cartMode==='quick'){
        checkoutBtn.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©';
        checkoutBtn.onclick = ()=>{ setCartMode('full'); };
      }else{
        checkoutBtn.textContent = 'Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡';
        checkoutBtn.onclick = onCheckout;
      }
    }
    function openCart(mode='full'){
      setCartMode(mode);
      drawCart();
      overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
    }
    function closeCart(){
      overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true');
    }
    closeCartBtn.addEventListener('click', closeCart);
    overlay.addEventListener('click', e=>{ if(e.target===overlay) closeCart(); });
    window.addEventListener('dream:openCart', ()=> openCart('full'));

    // Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø© -> ÙˆØ¶Ø¹ Ø³Ø±ÙŠØ¹
    document.addEventListener('click', e=>{
      const btn = e.target.closest('button[data-id]'); if(!btn) return;
      const id = btn.getAttribute('data-id'); const item = products.find(p=>p.id===id); if(!item) return;
      if(item.type==='physical' && (cart.get(id)||0) >= item.stock){ alert('ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬.'); return; }
      cart.set(id, (cart.get(id)||0)+1); localStorage.setItem(CART_KEY, JSON.stringify([...cart.entries()])); window.dispatchEvent(new Event('dream:cartUpdated'));
      toast(`Ø£ÙØ¶ÙŠÙ "${item.title}" Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©`);
      openCart('quick');
    });

    function drawCart(){
      rows.innerHTML=''; let total=0;
      for(const [id, qty] of cart.entries()){
        const p = products.find(x=>x.id===id); if(!p) continue;
        total += p.price*qty;
        const r = document.createElement('div');
        r.className='r';
        r.innerHTML = `
          <div>
            <div><strong>${p.title}</strong> <span class="badge">${p.type==='digital'?'Ø±Ù‚Ù…ÙŠ':'Ù…Ù„Ù…ÙˆØ³'}</span></div>
            <div class="muted">${money(p.price)} Ã— ${qty}</div>
          </div>
          <div class="qty">
            <button data-op="del" data-id="${id}" aria-label="Ø­Ø°Ù">ğŸ—‘ï¸</button>
            <button data-op="inc" data-id="${id}" aria-label="Ø²ÙŠØ§Ø¯Ø©">+</button>
            <span>${qty}</span>
            <button data-op="dec" data-id="${id}" aria-label="Ù†Ù‚Øµ">âˆ’</button>
          </div>`;
        rows.appendChild(r);
      }
      const tot = document.createElement('div');
      tot.className='r'; tot.innerHTML = `<div><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></div><div><strong>${money(total)}</strong></div>`;
      rows.appendChild(tot);
    }

    rows.addEventListener('click', e=>{
      const btn = e.target.closest('button[data-op]'); if(!btn) return;
      const id = btn.getAttribute('data-id'); const op = btn.getAttribute('data-op');
      const item = products.find(p=>p.id===id); if(!item) return;
      if(op==='inc'){
        if(item.type==='physical' && (cart.get(id)||0) >= item.stock){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø®Ø²ÙˆÙ† Ø¥Ø¶Ø§ÙÙŠ.'); return; }
        cart.set(id,(cart.get(id)||0)+1); toast(`Ø²ÙÙŠØ¯Øª ÙƒÙ…ÙŠØ© "${item.title}"`);
      }else if(op==='dec'){
        const n=(cart.get(id)||0)-1;
        if(n<=0){ cart.delete(id); toast(`Ø£ÙØ²ÙŠÙ„ "${item.title}" Ù…Ù† Ø§Ù„Ø³Ù„Ø©`); }
        else { cart.set(id,n); toast(`Ù†ÙÙ‚ØµØª ÙƒÙ…ÙŠØ© "${item.title}"`); }
      }else if(op==='del'){
        cart.delete(id); toast(`Ø­ÙØ°Ù "${item.title}" Ù…Ù† Ø§Ù„Ø³Ù„Ø©`);
      }
      localStorage.setItem(CART_KEY, JSON.stringify([...cart.entries()])); window.dispatchEvent(new Event('dream:cartUpdated'));
      drawCart();
    });

    function onCheckout(){
      if(cart.size===0){ alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©.'); return; }
      alert('Ø´ÙƒØ±Ù‹Ø§ Ù„Ùƒ! ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø·Ù„Ø¨Ùƒ Ù…Ø¨Ø¯Ø¦ÙŠÙ‹Ø§ (Ù†Ù…ÙˆØ°Ø¬).');
      cart.clear(); localStorage.setItem(CART_KEY, JSON.stringify([...cart.entries()])); window.dispatchEvent(new Event('dream:cartUpdated'));
      drawCart(); closeCart();
    }
  </script>
</body>
</html>
