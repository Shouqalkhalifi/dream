<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>dream - رأس الصفحة</title>
  <style>
    :root{
      --bg-0:#0f1115;       /* خلفية الهيدر الداكنة */
      --bg-1:#141820;       /* طبقة أدكن خفيفة */
      --txt:#eef1f5;        /* نص فاتح */
      --muted:#a6b0c0;
      --border:rgba(255,255,255,.08);
      --accent:#3ba9ff;     /* لون تمييز مريح */
      --badge:#222a36;
      --pill:#1b2230;
    }
    *{box-sizing:border-box}
    body{margin:0;background:transparent;color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Kufi Arabic",sans-serif}

    header{
      position:sticky; top:0; z-index:60;
      background:linear-gradient(0deg, var(--bg-1), var(--bg-0));
      border-bottom:1px solid var(--border);
      backdrop-filter:saturate(140%) blur(8px);
    }
    .nav{max-width:1200px;margin:auto;padding:12px 20px;display:flex;align-items:center;gap:14px}
    /* شعار دائري */
    .brand{display:flex;align-items:center;gap:10px;color:var(--txt);text-decoration:none}
    .logo{
      width:36px;height:36px;border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #8bd0ff, #3ba9ff 60%, #2563eb);
      border:1px solid rgba(255,255,255,.2);
      box-shadow:0 2px 14px rgba(59,169,255,.35) inset, 0 8px 24px rgba(0,0,0,.35);
      display:inline-block;
    }
    .brand b{letter-spacing:.4px}

    /* روابط سطح المكتب */
    .links{margin-inline-start:auto;display:flex;gap:8px;align-items:center}
    .links a{
      color:var(--txt);text-decoration:none;font-weight:700;
      padding:8px 12px;border-radius:12px;background:transparent;border:1px solid var(--border);
      transition:.18s;
    }
    .links a:hover{background:var(--pill);border-color:#2b3444}
    .links a.active{background:var(--badge);border-color:#374150}

    /* البحث */
    .search{
      position:relative;display:flex;align-items:center;gap:8px;background:var(--pill);
      border:1px solid var(--border);padding:8px 10px;border-radius:12px;margin-inline-start:12px
    }
    .search input{
      background:transparent;border:none;color:var(--txt);outline:none;width:220px;
    }
    .search button{
      background:var(--accent);color:#051018;border:none;padding:7px 10px;border-radius:8px;font-weight:800;cursor:pointer;
    }

    /* زر السلة + البادج */
    .cart-btn{position:relative}
    .cart-count{
      position:absolute;top:-6px;inset-inline-end:-6px;min-width:20px;height:20px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      font-size:12px;background:#22c55e;color:#051018;border:1px solid rgba(0,0,0,.3)
    }

    /* الجوال */
    .drawer{display:none}
    .menu-toggle{display:none}
    @media (max-width:880px){
      .search{display:none}
      .links{display:none}             /* إخفاء القائمة الكبيرة على الشاشات الصغيرة */
      .menu-toggle{
        display:inline-flex;margin-inline-start:auto;border:1px solid var(--border);
        padding:8px 10px;border-radius:10px;cursor:pointer;background:var(--pill);color:var(--txt);font-weight:700
      }
      .drawer{
        display:none; position:fixed; inset:0 0 auto auto; width:min(86vw,360px); height:100dvh;
        background:linear-gradient(0deg, var(--bg-1), var(--bg-0));
        border-inline-start:1px solid var(--border); padding:18px; z-index:70;
        box-shadow:-12px 0 40px rgba(0,0,0,.45);
      }
      .drawer.open{display:block}
      .drawer a{
        display:block;color:var(--txt);text-decoration:none;padding:12px 10px;border-radius:12px;
        border:1px solid var(--border);margin-bottom:10px;background:transparent
      }
      .drawer a:hover{background:var(--pill);border-color:#2b3444}
      .drawer .search-m{
        display:flex;gap:8px;background:var(--pill);border:1px solid var(--border);
        padding:8px 10px;border-radius:12px;margin:8px 0 14px
      }
      .drawer input{flex:1;background:transparent;border:none;color:var(--txt);outline:none}
      .drawer button{background:var(--accent);color:#051018;border:none;padding:8px 10px;border-radius:10px;font-weight:800}
    }
  </style>
</head>
<body>
<header>
  <nav class="nav" aria-label="التنقّل الرئيسي">
    <a class="brand" href="index.html" aria-label="الانتقال إلى الرئيسية">
      <span class="logo" aria-hidden="true"></span>
      <b>dream</b>
    </a>

    <!-- بحث سطح مكتب -->
    <form class="search" role="search" aria-label="بحث المنتجات" onsubmit="return false;">
      <input id="q" type="search" placeholder="ابحثي عن منتج…" inputmode="search" autocomplete="off" aria-label="ابحثي" />
      <button id="searchBtn" type="button">بحث</button>
    </form>

    <!-- روابط سطح مكتب (تظهر فقط لغير الجوال) -->
    <div class="links" role="menubar">
      <a class="active" href="index.html" role="menuitem">الرئيسية</a>
      <a href="products.html" role="menuitem">المنتجات</a>
      <a href="contact.html" role="menuitem">تواصل</a>
      <a href="#" role="menuitem" id="openCart" class="cart-btn" aria-label="فتح السلة">🛒
        <span id="cartCount" class="cart-count" hidden>0</span>
      </a>
    </div>

    <!-- زر قائمة الجوال -->
    <button class="menu-toggle" id="menuToggle" aria-label="فتح القائمة">القائمة</button>
  </nav>

  <!-- درج الجوال فقط -->
  <aside class="drawer" id="drawer" aria-label="قائمة الجوال" aria-hidden="true">
    <div class="search-m" role="search" aria-label="بحث المنتجات">
      <input id="qm" type="search" placeholder="ابحثي عن منتج…" inputmode="search" autocomplete="off" />
      <button id="searchBtnM" type="button">بحث</button>
    </div>
    <a href="index.html">الرئيسية</a>
    <a href="products.html">المنتجات</a>
    <a href="contact.html">تواصل</a>
    <a href="#" id="openCartMobile" class="cart-btn">السلة <span id="cartCountM" class="cart-count" hidden>0</span></a>
  </aside>
</header>

<script>
  // أمن إدخال نص البحث
  function sanitize(s){ return (s||"").toString().replace(/[<>"']/g,""); }
  // بثّ حدث البحث ليستمع له index أو products
  function fireSearch(value){
    window.dispatchEvent(new CustomEvent('dream:search',{detail:{value}}));
  }
  document.getElementById('searchBtn')?.addEventListener('click', ()=>{
    const value = sanitize(document.getElementById('q').value).trim();
    fireSearch(value);
  });
  // بحث الجوال
  document.getElementById('searchBtnM')?.addEventListener('click', ()=>{
    const value = sanitize(document.getElementById('qm').value).trim();
    fireSearch(value);
    drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');
  });

  // درج الجوال
  const drawer = document.getElementById('drawer');
  const toggle = document.getElementById('menuToggle');
  toggle?.addEventListener('click', ()=>{
    const open = !drawer.classList.contains('open');
    drawer.classList.toggle('open', open);
    drawer.setAttribute('aria-hidden', String(!open));
  });

  // فتح السلة
  const openCartBtns = [document.getElementById('openCart'), document.getElementById('openCartMobile')];
  openCartBtns.forEach(btn=>{
    btn?.addEventListener('click', (e)=>{ e.preventDefault(); window.dispatchEvent(new Event('dream:openCart')); });
  });

  // شارة عدد السلة (تقرأ من localStorage وتُحدّث حياً)
  const CART_KEY = 'dream.cart.v1';
  function cartCount(){
    try{
      const m = new Map(JSON.parse(localStorage.getItem(CART_KEY) || '[]'));
      let n=0; for(const [,qty] of m.entries()) n += Number(qty)||0;
      return n;
    }catch{ return 0; }
  }
  function renderCartBadge(){
    const n = cartCount();
    const c1 = document.getElementById('cartCount');
    const c2 = document.getElementById('cartCountM');
    [c1,c2].forEach(c=>{
      if(!c) return;
      if(n>0){ c.textContent = n; c.hidden = false; } else { c.hidden = true; }
    });
  }
  renderCartBadge();
  window.addEventListener('storage', e=>{ if(e.key===CART_KEY) renderCartBadge(); });
  window.addEventListener('dream:cartUpdated', renderCartBadge);
</script>
</body>
</html>
